<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard - Emergency Medical ID v3.0</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>👤</text></svg>">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Theme Toggle -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
        <i class="fas fa-moon" id="themeIcon"></i>
    </button>

    <div class="dashboard-container">
        <!-- Enhanced Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="d-flex align-items-center">
                    <i class="fas fa-user-injured fa-2x me-3"></i>
                    <div>
                        <h4 class="sidebar-brand mb-0">Patient Portal</h4>
                        <small class="opacity-75" id="userEmail">Loading...</small>
                    </div>
                </div>
            </div>
            <div class="sidebar-nav">
                <a href="#overview" class="nav-link active" data-bs-toggle="tab">
                    <i class="fas fa-tachometer-alt"></i>Overview
                </a>
                <a href="#profile" class="nav-link" data-bs-toggle="tab">
                    <i class="fas fa-user-edit"></i>Medical Profile
                </a>
                <a href="#qrcode" class="nav-link" data-bs-toggle="tab">
                    <i class="fas fa-qrcode"></i>QR Code Manager
                </a>
                <a href="#sharing" class="nav-link" data-bs-toggle="tab">
                    <i class="fas fa-share-alt"></i>Share & Export
                </a>
                <a href="#security" class="nav-link" data-bs-toggle="tab">
                    <i class="fas fa-shield-alt"></i>Security & Privacy
                </a>
            </div>
            <div style="margin-top: auto; padding: var(--space-6);">
                <button class="btn btn-outline-light w-100" id="logoutBtn">
                    <i class="fas fa-sign-out-alt me-2"></i>Secure Logout
                </button>
            </div>
        </nav>

        <!-- Enhanced Main Content -->
        <main class="main-content">
            <!-- Enhanced Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">Your Medical Dashboard</h1>
                    <p class="page-subtitle">Manage your emergency medical information securely</p>
                </div>
                <div class="d-flex align-items-center gap-3">
                    <div class="badge badge-success">
                        <i class="fas fa-shield-alt me-1"></i>HIPAA Compliant
                    </div>
                    <div class="text-muted small">
                        Last updated: <span id="lastUpdated">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Alert Container -->
            <div id="alert-container"></div>

            <div class="tab-content">
                <!-- Enhanced Overview Tab -->
                <div class="tab-pane fade show active" id="overview-tab">
                    <!-- Profile Completion Progress -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <i class="fas fa-chart-line me-2"></i>Profile Completion
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <span class="fw-bold">Completion Status</span>
                                <span id="completionPercentage" class="badge bg-danger">0%</span>
                            </div>
                            <div class="progress-container">
                                <div class="progress-bar" id="completionProgress" style="width: 0%"></div>
                            </div>
                            <p class="text-muted small mt-2 mb-0">Complete your profile to generate your emergency QR code</p>
                        </div>
                    </div>

                    <!-- Enhanced Status Cards -->
                    <div class="row g-4 mb-4">
                        <div class="col-md-3">
                            <div class="status-card">
                                <i class="status-card-icon fas fa-user-check"></i>
                                <h4 id="profileStatus" class="text-danger">Incomplete</h4>
                                <p class="text-muted mb-0">Profile Status</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="status-card">
                                <i class="status-card-icon fas fa-qrcode"></i>
                                <h4 id="qrStatus" class="text-danger">Not Generated</h4>
                                <p class="text-muted mb-0">QR Code Status</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="status-card">
                                <i class="status-card-icon fas fa-id-card"></i>
                                <h4 id="patientIdStatusDisplay">Not Assigned</h4>
                                <p class="text-muted mb-0">Patient ID</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="status-card">
                                <i class="status-card-icon fas fa-history"></i>
                                <h4 id="accessCount">0</h4>
                                <p class="text-muted mb-0">Emergency Access</p>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Quick Actions -->
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-rocket me-2"></i>Quick Start Guide
                                </div>
                                <div class="card-body">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="badge bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 2.5rem; height: 2.5rem; font-size: 1.1rem; font-weight: 700;">1</div>
                                                <div>
                                                    <h6 class="fw-bold">Complete Medical Profile</h6>
                                                    <p class="text-muted small mb-0">Add your personal information, medical conditions, and emergency contacts.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="badge bg-success rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 2.5rem; height: 2.5rem; font-size: 1.1rem; font-weight: 700;">2</div>
                                                <div>
                                                    <h6 class="fw-bold">Generate QR Code</h6>
                                                    <p class="text-muted small mb-0">Create your emergency QR code for instant medical information access.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="badge bg-info rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 2.5rem; height: 2.5rem; font-size: 1.1rem; font-weight: 700;">3</div>
                                                <div>
                                                    <h6 class="fw-bold">Download & Share</h6>
                                                    <p class="text-muted small mb-0">Download high-quality QR code and share your Patient ID.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="d-flex align-items-start">
                                                <div class="badge bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 2.5rem; height: 2.5rem; font-size: 1.1rem; font-weight: 700;">4</div>
                                                <div>
                                                    <h6 class="fw-bold">Emergency Preparedness</h6>
                                                    <p class="text-muted small mb-0">Keep QR code accessible for emergency medical access.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-shield-check me-2"></i>Security Information
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-success">
                                        <i class="fas fa-lock me-2"></i>
                                        <strong>256-bit Encryption</strong><br>
                                        <small>All data encrypted using industry-standard security protocols.</small>
                                    </div>
                                    <div class="alert alert-info">
                                        <i class="fas fa-user-shield me-2"></i>
                                        <strong>Privacy Protected</strong><br>
                                        <small>Your information is only accessible with your unique Patient ID.</small>
                                    </div>
                                    <div class="alert alert-warning">
                                        <i class="fas fa-mobile-alt me-2"></i>
                                        <strong>Keep QR Accessible</strong><br>
                                        <small>Save to your phone or print for your wallet.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Profile Tab -->
                <div class="tab-pane fade" id="profile-tab">
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-user-edit me-2"></i>Medical Information Management
                                </div>
                                <div class="card-body">
                                    <form id="profileForm">
                                        <div class="row g-4">
                                            <!-- Personal Information Section -->
                                            <div class="col-12">
                                                <h5 class="text-primary border-bottom pb-2 mb-3">
                                                    <i class="fas fa-user me-2"></i>Personal Information
                                                </h5>
                                                <div class="row g-3">
                                                    <div class="col-md-6">
                                                        <label for="firstName" class="form-label">First Name *</label>
                                                        <input type="text" class="form-control" id="firstName" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="lastName" class="form-label">Last Name *</label>
                                                        <input type="text" class="form-control" id="lastName" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="dateOfBirth" class="form-label">Date of Birth *</label>
                                                        <input type="date" class="form-control" id="dateOfBirth" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="bloodType" class="form-label">Blood Type *</label>
                                                        <select class="form-select" id="bloodType" required>
                                                            <option value="">Select Blood Type</option>
                                                            <option value="A+">A+ (A Positive)</option>
                                                            <option value="A-">A- (A Negative)</option>
                                                            <option value="B+">B+ (B Positive)</option>
                                                            <option value="B-">B- (B Negative)</option>
                                                            <option value="AB+">AB+ (AB Positive)</option>
                                                            <option value="AB-">AB- (AB Negative)</option>
                                                            <option value="O+">O+ (O Positive)</option>
                                                            <option value="O-">O- (O Negative)</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Medical Information Section -->
                                            <div class="col-12">
                                                <h5 class="text-primary border-bottom pb-2 mb-3">
                                                    <i class="fas fa-notes-medical me-2"></i>Medical Information
                                                </h5>
                                                <div class="row g-3">
                                                    <div class="col-12">
                                                        <label for="allergies" class="form-label">
                                                            <i class="fas fa-exclamation-triangle text-warning me-1"></i>Allergies
                                                        </label>
                                                        <input type="text" class="form-control" id="allergies" 
                                                               placeholder="e.g., Penicillin, Nuts, Shellfish (comma separated)">
                                                        <small class="text-muted">Critical: List all known allergies for emergency responders</small>
                                                    </div>
                                                    <div class="col-12">
                                                        <label for="conditions" class="form-label">
                                                            <i class="fas fa-heartbeat text-danger me-1"></i>Medical Conditions
                                                        </label>
                                                        <input type="text" class="form-control" id="conditions" 
                                                               placeholder="e.g., Diabetes, Hypertension, Asthma (comma separated)">
                                                        <small class="text-muted">Include chronic conditions and ongoing health issues</small>
                                                    </div>
                                                    <div class="col-12">
                                                        <label for="medications" class="form-label">
                                                            <i class="fas fa-pills text-info me-1"></i>Current Medications
                                                        </label>
                                                        <textarea class="form-control" id="medications" rows="3"
                                                                  placeholder="e.g., Metformin 500mg twice daily, Lisinopril 10mg once daily"></textarea>
                                                        <small class="text-muted">Include dosage and frequency when possible</small>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Emergency Contact Section -->
                                            <div class="col-12">
                                                <h5 class="text-primary border-bottom pb-2 mb-3">
                                                    <i class="fas fa-phone me-2"></i>Emergency Contact
                                                </h5>
                                                <div class="row g-3">
                                                    <div class="col-md-6">
                                                        <label for="emergencyContactName" class="form-label">Contact Name *</label>
                                                        <input type="text" class="form-control" id="emergencyContactName" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="emergencyContactPhone" class="form-label">Contact Phone *</label>
                                                        <input type="tel" class="form-control" id="emergencyContactPhone" required>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <label for="emergencyContactRelation" class="form-label">Relationship</label>
                                                        <select class="form-select" id="emergencyContactRelation">
                                                            <option value="Spouse">Spouse/Partner</option>
                                                            <option value="Parent">Parent</option>
                                                            <option value="Child">Child</option>
                                                            <option value="Sibling">Sibling</option>
                                                            <option value="Friend">Friend</option>
                                                            <option value="Other">Other</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="text-center mt-5">
                                            <button type="submit" class="btn btn-primary btn-lg px-5" id="saveBtn">
                                                <i class="fas fa-save me-2"></i>Save Profile & Generate QR Code
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-lightbulb me-2"></i>Profile Tips
                                </div>
                                <div class="card-body">
                                    <div class="mb-4">
                                        <h6><i class="fas fa-check text-success me-2"></i>Complete Profile</h6>
                                        <small class="text-muted">Fill in all relevant medical information for emergency responders.</small>
                                    </div>
                                    <div class="mb-4">
                                        <h6><i class="fas fa-sync text-info me-2"></i>Keep Updated</h6>
                                        <small class="text-muted">Update your profile whenever your medical conditions or medications change.</small>
                                    </div>
                                    <div class="mb-4">
                                        <h6><i class="fas fa-shield-alt text-warning me-2"></i>Privacy First</h6>
                                        <small class="text-muted">Your information is encrypted and only accessible with your Patient ID.</small>
                                    </div>
                                    <div class="mb-0">
                                        <h6><i class="fas fa-mobile-alt text-primary me-2"></i>Mobile Ready</h6>
                                        <small class="text-muted">Access and update your profile from any device.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced QR Code Tab -->
                <div class="tab-pane fade" id="qrcode-tab">
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-qrcode me-2"></i>Your Emergency QR Code
                                </div>
                                <div class="card-body">
                                    <div id="qrContainer" class="qr-container">
                                        <i class="fas fa-qrcode fa-4x text-muted mb-4"></i>
                                        <h5 class="text-muted mb-2">QR Code Not Generated</h5>
                                        <p class="text-muted mb-0">Complete and save your medical profile to generate your emergency QR code.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-id-card me-2"></i>Patient Information
                                </div>
                                <div class="card-body text-center">
                                    <h6 class="mb-3">Patient ID</h6>
                                    <div class="badge bg-primary fs-6 mb-4 text-mono p-3" id="patientIdDisplay" style="word-break: break-all;">Not Generated</div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-success" id="downloadBtn" disabled>
                                            <i class="fas fa-download me-2"></i>Download QR Code
                                        </button>
                                        <button class="btn btn-outline-primary" id="regenerateBtn" disabled>
                                            <i class="fas fa-sync me-2"></i>Regenerate QR Code
                                        </button>
                                        <button class="btn btn-outline-secondary" id="printBtn" disabled>
                                            <i class="fas fa-print me-2"></i>Print QR Code
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mt-4">
                                <div class="card-header">
                                    <i class="fas fa-mobile-alt me-2"></i>Usage Instructions
                                </div>
                                <div class="card-body">
                                    <div class="small">
                                        <div class="mb-3">
                                            <strong><i class="fas fa-mobile-alt text-primary me-1"></i>Save on Phone:</strong> 
                                            Download and save to your phone's photo gallery for instant access.
                                        </div>
                                        <div class="mb-3">
                                            <strong><i class="fas fa-wallet text-success me-1"></i>Print & Carry:</strong> 
                                            Print a wallet-sized version to carry with you.
                                        </div>
                                        <div class="mb-0">
                                            <strong><i class="fas fa-ambulance text-danger me-1"></i>Emergency Access:</strong> 
                                            Medical personnel can scan this QR code for instant access to your information.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Sharing Tab -->
                <div class="tab-pane fade" id="sharing-tab">
                    <div class="row g-4">
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-share-alt me-2"></i>Share with Healthcare Providers
                                </div>
                                <div class="card-body">
                                    <p class="mb-3">Healthcare providers can access your medical information using your Patient ID:</p>
                                    <div class="input-group mb-3">
                                        <input type="text" class="form-control text-mono" id="sharePatientId" readonly value="Not Generated">
                                        <button class="btn btn-outline-secondary" id="copyIdBtn" disabled>
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <strong>Secure Sharing:</strong> Only provide your Patient ID to authorized healthcare professionals.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-download me-2"></i>Export Options
                                </div>
                                <div class="card-body">
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-outline-primary" disabled>
                                            <i class="fas fa-file-pdf me-2"></i>Export as PDF
                                        </button>
                                        <button class="btn btn-outline-success" disabled>
                                            <i class="fas fa-file-alt me-2"></i>Export as Text
                                        </button>
                                        <button class="btn btn-outline-info" disabled>
                                            <i class="fas fa-file-code me-2"></i>Export as JSON
                                        </button>
                                    </div>
                                    <div class="alert alert-warning mt-3">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        <strong>Privacy Notice:</strong> Exported files contain sensitive medical information.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Tab -->
                <div class="tab-pane fade" id="security-tab">
                    <div class="row g-4">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-shield-alt me-2"></i>Security & Privacy Information
                                </div>
                                <div class="card-body">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <h6><i class="fas fa-lock text-primary me-2"></i>Data Encryption</h6>
                                            <p class="text-muted small">All your medical data is encrypted using 256-bit encryption, the same standard used by banks and government agencies.</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6><i class="fas fa-user-shield text-success me-2"></i>Access Control</h6>
                                            <p class="text-muted small">Only authorized healthcare professionals with your Patient ID can access your information.</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6><i class="fas fa-history text-info me-2"></i>Audit Logging</h6>
                                            <p class="text-muted small">Every access to your medical information is logged with timestamp and healthcare provider details.</p>
                                        </div>
                                        <div class="col-md-6">
                                            <h6><i class="fas fa-globe text-warning me-2"></i>International Standards</h6>
                                            <p class="text-muted small">Our system complies with HIPAA, GDPR, and other international healthcare privacy regulations.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <i class="fas fa-info-circle me-2"></i>Security Tips
                                </div>
                                <div class="card-body">
                                    <div class="alert alert-success">
                                        <strong>✅ Do:</strong><br>
                                        <small>Share your Patient ID only with authorized medical professionals during emergencies.</small>
                                    </div>
                                    <div class="alert alert-danger">
                                        <strong>❌ Don't:</strong><br>
                                        <small>Never share your Patient ID on social media or with unauthorized individuals.</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/patient-dashboard.js"></script>
</body>
</html>
